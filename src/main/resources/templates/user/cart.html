<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="utf-8">
<title>Tha ARTISAN</title>
<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" >
</head>
<body class="text-center ">
<header th:include="user/index.html :: header "></header>
	<h2 class="fw-bold m-3" style="color:#9d062d;" >Mon Panier</h2>
	<div class="ms-5 ps-4">
	<div class="row mt-4 me-5 ms-5">
	 <div class="col-sm-7 bg-body-secondary p-5 mb-4 me-5" style="border-radius:23px; background:#f5f5f5;">
	    <div class="bg-dark-subtle p-4 pt-2 pb-2 mb-4" th:each="cart:${carts}" style="border-radius:18px;background:#e7e7e7;">
	      <div class="d-flex pt-3">
	          <div class="p-2 ms-1 me-1"><img th:src="@{image/{img} (img=${cart.product.photo})}" width=100px></div>
			  <div class="p-2 ms-4 text-start me-5" style="width:57%;">
			    <h4 th:text="${cart.product.description}" style="color:#9d062d;"></h4>
			    <h5 class="productSubtotal fw-bolder" style="color:#3a4474;" th:id="'subtotal'+${cart.product.id}" th:text="${cart.getSubtotal}+' dh'"></h5>
			    <input value="plus de détail" class="fw-bold" type="submit" style="width:180px;background:#c59f69;border-radius:10px;border:none;height:30px;" >
			   
			  </div>
			  <div class="p-2 pb-5 ms-5">
			        <div><svg xmlns="http://www.w3.org/2000/svg" th:pid="${cart.product.id}" class="me-4 f" width="37" height="37" viewBox="0 0 25 25" fill="none">
<path d="M17.2004 22.7499C14.1404 22.7499 11.6504 20.2599 11.6504 17.1999C11.6504 14.1399 14.1404 11.6499 17.2004 11.6499C20.2604 11.6499 22.7504 14.1399 22.7504 17.1999C22.7504 20.2599 20.2604 22.7499 17.2004 22.7499ZM17.2004 13.1499C14.9704 13.1499 13.1504 14.9699 13.1504 17.1999C13.1504 19.4299 14.9704 21.2499 17.2004 21.2499C19.4304 21.2499 21.2504 19.4299 21.2504 17.1999C21.2504 14.9699 19.4304 13.1499 17.2004 13.1499Z" fill="#9d062d"/>
<path d="M18.9904 18.01H15.4004C14.9904 18.01 14.6504 17.67 14.6504 17.26C14.6504 16.85 14.9904 16.51 15.4004 16.51H18.9904C19.4004 16.51 19.7404 16.85 19.7404 17.26C19.7404 17.67 19.4104 18.01 18.9904 18.01Z" fill="#9d062d"/>
<path d="M17.1992 19.85C16.7892 19.85 16.4492 19.51 16.4492 19.1V15.51C16.4492 15.1 16.7892 14.76 17.1992 14.76C17.6092 14.76 17.9492 15.1 17.9492 15.51V19.1C17.9492 19.51 17.6092 19.85 17.1992 19.85Z" fill="#9d062d"/>
<path d="M12 21.6501C11.69 21.6501 11.38 21.6101 11.13 21.5201C8.57 20.6501 1.25 16.4101 1.25 8.69012C1.25 5.19012 4.08 2.3501 7.56 2.3501C9.23 2.3501 10.83 3.02012 12 4.19012C13.17 3.02012 14.78 2.3501 16.44 2.3501C19.92 2.3501 22.75 5.19012 22.75 8.69012C22.75 10.6401 22.28 12.5101 21.35 14.2601C21.24 14.4701 21.03 14.6201 20.79 14.6501C20.54 14.6801 20.31 14.6001 20.14 14.4201C19.36 13.6001 18.31 13.1401 17.19 13.1401C14.96 13.1401 13.14 14.9601 13.14 17.1901C13.14 18.1801 13.51 19.1401 14.18 19.8901C14.34 20.0701 14.4 20.3101 14.35 20.5401C14.3 20.7701 14.14 20.9701 13.93 21.0701C13.53 21.2501 13.17 21.4001 12.84 21.5101C12.61 21.6101 12.31 21.6501 12 21.6501ZM7.56 3.8501C4.91 3.8501 2.75 6.02012 2.75 8.69012C2.75 15.5301 9.31999 19.3101 11.62 20.1001C11.8 20.1701 12.19 20.1601 12.37 20.1001C12.4 20.0901 12.43 20.0801 12.46 20.0701C11.94 19.2101 11.65 18.2201 11.65 17.2001C11.65 14.1401 14.14 11.6501 17.2 11.6501C18.38 11.6501 19.5 12.0201 20.44 12.6901C20.98 11.4101 21.25 10.0701 21.25 8.69012C21.25 6.02012 19.09 3.8501 16.44 3.8501C14.94 3.8501 13.5 4.57015 12.6 5.78015C12.32 6.16015 11.68 6.16015 11.4 5.78015C10.5 4.57015 9.06 3.8501 7.56 3.8501Z" fill="#292D32"/>
</svg> <a th:href="@{/delete/{pid} (pid= ${cart.product.id})}"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#9d062d" class="bi bi-trash3 del" viewBox="0 0 17 17">
  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
</svg></a></div>
			        <div class="row text-center mt-3" >
			        <button class="sub" style="border-top-left-radius:9px;border-bottom-left-radius:9px;background:#c59f69;border:none; width:40px;height:27px;" th:pid="${cart.product.id}"><b>-</b></button>
				    <input th:value="${cart.quatite}" name="q" class="col-2 text-center input-filed fs-5" style="height:27px;background:#c59f69;border:none; width:40px;" type="text" th:id="'qtyBox'+ ${cart.product.id}" >
				    
				    <button class="col-2 add" style="border-top-right-radius:9px;border-bottom-right-radius:9px;background:#c59f69;border:none;width:40px;height:27px;" th:pid="${cart.product.id}"><b>+</b></button>
				  
		             </div>
	         </div>
	    </div>
	    </div>
	    </div>
	    <div class="col-sm-3 me-5 ms-5 ">
		      <div class="row">
		        <div class="col-3 col-sm-12 mb-3 p-4 pt-2" style="border-radius:20px; background:#f5f5f5;">
		           <h4 class="text-center mb-3" style="color:#9d062d;">Sommaire</h4>
		          <div class="d-flex mt-2 ps-3 pe-3 mb-2" style="border-radius:15px;background:#e7e7e7;" >
				     <div class="me-auto p-2 " style="color:#3a4474;"><h5 class="fw-bold">Subtotal : </h5></div>
				     <div class="p-2" ><h6 class="fs-5 " id="total" th:text="${total}+'dh'"></h6></div>
				  </div>
				  <div class="d-flex mb-2 ps-3 pe-3" style="border-radius:15px;background:#e7e7e7;">
				     <div class="me-auto p-2 " style="color:#3a4474;"><h5 class="fw-bold">Livraison : </h5></div>
				     <div class="p-2" ><h6 class="fs-5 " >69 dh</h6></div>
				  </div>
				  <div class="d-flex mb-2 ps-3 pe-3" style="border-radius:15px;background:#e7e7e7;">
				     <div class="me-auto p-2" style="color:#3a4474;"><h5 class="fw-bold">Total : </h5></div>
				     <div class="p-2" ><h6 class="fs-5" id="somme"  th:text="${somme}+'dh'"></h6></div>
				  </div>
		        </div>
		        
		        <div class="col-3 col-sm-12 mb-3 p-4 pb-2 pt-2" style="border-radius:20px; background:#f5f5f5;">
		           <h4 class="text-center mb-3" style="color:#9d062d;">Adresse de Livraison</h4>
		          <div class=" mt-2 ps-3 pe-3 mb-3" style="border-radius:15px;background:#e7e7e7;">
				     <div class="d-flex me-auto pt-2" > <h6 th:text="' Welcome: '+${user.name}"> </h6></div>
				     <div class="d-flex " ><h6 th:text="' Email: '+${user.email}"> </h6></div>
				     <div class="d-flex pb-2" > <h6 th:text="' Tel : '+${user.telephone}"> </h6></div>
				  </div>
		        </div>
		        
		        <div class="col-3 col-sm-12 mb-4 p-4 pt-2" style="border-radius:20px; background:#f5f5f5;">
		           <h4 class="text-center mb-3" style="color:#9d062d;">Methode de Paiement</h4>
				  <div class="d-flex mb-3 ps-3 pe-3" style="border-radius:15px;background:#e7e7e7;">
				     <label class="me-auto p-2">
				     <input type="radio" name="radio"/>
				     <span class="fw-bold ps-3 fs-5" >Paiement par carte bancaire  </span>
				     </label>
				     
				  </div>
				  <div class="d-flex mb-2 ps-3 pe-3" style="border-radius:15px;background:#e7e7e7;">
				    <label class="me-auto p-2">
				     <input type="radio" name="radio"/>
				     <span class="fw-bold ps-3 fs-5" >Paiement à la livraison </span>
				     </label>
				  </div>
		        </div>
		        <div class="text-center"><button class="btn text-center text-light fs-5" type="submit" style="width:250px;background:#a85a50;border-radius:15px;"><b>Valider</b></button></div>
		       
		    </div>
	    
	 </div>
	 </div>
</div>
<footer class="footer text-center fixed-bottom" style="margin-top:-1.66%;" th:include="user/index.html :: footer "></footer>
<script src="https://code.jquery.com/jquery-3.6.3.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" ></script>
<script >
	let star = document.querySelectorAll('input');
	let showValue = document.querySelector('#rating-value');
	
	for (let i = 0; i < star.length; i++) {
		star[i].addEventListener('click', function() {
			i = this.value;
	
			showValue.innerHTML = i + " out of 5";
});
	}
	
	
		
		$(".add").on("click",function(e){
		e.preventDefault();
		pid= $(this).attr("pid");
		console.log(pid);
		qty = document.querySelector('#qtyBox'+pid);
			qty.value = parseInt(qty.value) + 1;
			updateQty(pid,qty.value)
		});

		$(".sub").on("click",function(e){
		e.preventDefault();
		pid= $(this).attr("pid");
		qty = document.querySelector('#qtyBox'+pid);
		console.log(qty.value);
			if (qty.value <= 0) {
				qty.value = 1;
			}
			else{
				qty.value = parseInt(qty.value) - 1;
				
			}
			updateQty(pid,qty.value)
		});
		
		$(".f").on("click", function(e){
		   e.preventDefault();
		   pid= $(this).attr("pid");
		   console.log(pid);
		   favoris(pid);
		});

function favoris(pid){
 let url= 'http://localhost:8080/Favoris'+pid;
 $.ajax({
   url:url,
   method: "POST"
   
   }).done(function(response){ 
   console.log(response);
   })
 }	

 function updateQty(pid,q){
 let url= 'http://localhost:8080/update/'+pid+'/'+q;
 $.ajax({
 url:url,
   method: "POST"
   
   }).done(function(response){ 
   console.log(response);
   subtotal(response,pid);
   updateTotal();
   })
 }
 function subtotal(sub,pid){
   $("#subtotal"+pid).text(sub+" dh");
 }
 function updateTotal(){
   total=0.0;
   $(".productSubtotal").each(function(index,elem){
     total=total+parseFloat(elem.innerHTML);
     console.log(total);
   });
   somme=total+69;
   $("#total").text(total.toFixed(2) +" dh");
   $("#somme").text(somme.toFixed(2) +" dh");
 }		
</script>
</body>
</html>